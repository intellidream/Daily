<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Daily</title>
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="Daily.styles.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Critical: OS Detection for Background Strategy
        // Mac Catalyst: Needs Opaque Background to prevent White Flash.
        // Windows WebView2: Needs Transparent Background to respect App Theme (showing XAML Window Color).
        var isMac = navigator.userAgent.indexOf('Mac') !== -1 || navigator.userAgent.indexOf('iPhone') !== -1 || navigator.userAgent.indexOf('iPad') !== -1;

        if (isMac) {
            document.documentElement.classList.add('platform-mac');
        }
    </script>
    <style>
        /* Base loading variables */
        :root {
            --loading-bg: #f5f5f5;
            --loading-color: #594AE2;
        }

        /* System Preference Fallback (if no data-theme yet) */
        @media (prefers-color-scheme: dark) {
            :root {
                --loading-bg: #121212;
                --loading-color: #7e6fff;
            }
        }

        html,
        body {
            /* Default: Transparent (Windows/Platform Default) */
            /* This resolves to transparent, letting the underlying XAML Window color show */
            background-color: transparent;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* Mac Specific Override: Force Opaque to prevent Flash */
        .platform-mac body {
            background-color: var(--loading-bg) !important;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            font-family: 'Roboto', sans-serif;
            color: var(--loading-color);
            /* Background matches body */
            background-color: inherit;
        }

        .loading-icon {
            width: 48px;
            height: 48px;
            fill: currentColor;
            animation: spin 1.5s linear infinite;
            margin-bottom: 16px;
        }

        .loading-text {
            font-size: 1.5rem;
            font-weight: 500;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">
        <!-- Styles moved to head for critical rendering performance -->
        <div class="loading-container">
            <svg class="loading-icon" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="united-rocket" transform="translate(0, 30) translate(256 256) scale(1.2) translate(-256 -256)">
                    <path d="M 256 20 L 330 400 L 256 350 L 182 400 Z" fill="currentColor" />
                    <path d="M 280 200 L 420 300 L 300 300 Z" fill="currentColor" />
                    <path d="M 232 200 L 92 300 L 212 300 Z" fill="currentColor" />
                </g>
            </svg>
            <div class="loading-text">Loading Daily...</div>
        </div>
    </div>

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script>
        window.addEventListener('mouseup', function (event) {
            // Button 3 is the "Back" button on many mice
            if (event.button === 3) {
                event.preventDefault();
                DotNet.invokeMethodAsync('Daily', 'HandleNativeBack');
            }
        });


    </script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
    <script>
        window.dailyInterop = {
            setBodyAttribute: function (attr, value) {
                document.body.setAttribute(attr, value);
            },
            addClassToBody: function (className) {
                document.body.classList.add(className);
            },
            removeClassFromBody: function (className) {
                document.body.classList.remove(className);
            }
        };

        window.dailyMap = {
            map: null,
            initMap: function (elementId, lat, lon, apiKey) {
                if (this.map) {
                    this.map.remove();
                    this.map = null;
                }

                this.map = L.map(elementId).setView([lat, lon], 10);

                // OpenStreetMap Base Layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: 'Â© OpenStreetMap'
                }).addTo(this.map);

                // OpenWeatherMap Clouds Layer
                L.tileLayer(`https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${apiKey}`, {
                    maxZoom: 18,
                    opacity: 0.8
                }).addTo(this.map);

                // OpenWeatherMap Precipitation Layer (Precipitation Classic)
                L.tileLayer(`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${apiKey}`, {
                    maxZoom: 18,
                    attribution: 'Â© OpenWeatherMap'
                }).addTo(this.map);
            }
        };
    </script>
</body>

</html>