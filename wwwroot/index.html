<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Daily</title>
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="Daily.styles.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link rel="icon" href="data:,">
    <script>
        // Critical: Instant Theme Application via LocalStorage
        // This ensures the WebView paints the correct User Theme immediately, avoiding "System Dark" flash on "App Light".
        (function () {
            try {
                var storedTheme = localStorage.getItem('theme');
                if (storedTheme) {
                    document.documentElement.setAttribute('data-theme', storedTheme);
                } else {
                    // If no stored theme, check system preference
                    var systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.documentElement.setAttribute('data-theme', systemDark ? 'dark' : 'light');
                }

                // Mac Catalyst Detection for CSS override if needed (though data-theme should handle it now)
                if (navigator.userAgent.indexOf('Mac') !== -1 || navigator.userAgent.indexOf('iPhone') !== -1 || navigator.userAgent.indexOf('iPad') !== -1) {
                    document.documentElement.classList.add('platform-mac');
                }
            } catch (e) {
                console.error("Theme init error", e);
            }
        })();
    </script>
    <script>
        // Critical: OS Detection for Background Strategy
        // Mac Catalyst: Needs Opaque Background to prevent White Flash.
        // Windows WebView2: Needs Transparent Background to respect App Theme (showing XAML Window Color).
        var isMac = navigator.userAgent.indexOf('Mac') !== -1 || navigator.userAgent.indexOf('iPhone') !== -1 || navigator.userAgent.indexOf('iPad') !== -1;
        var rootStyle = document.documentElement.style;

        if (isMac) {
            // Mac: Use --loading-bg (Opaque)
            // We can't access VAR here easily in JS before CSS, but we can set the property.
            // Actually, best to set a class on body or just use CSS variables logic in style.
        }
    </script>
    <style>
        /* Base loading variables */
        :root {
            --loading-bg: #f5f5f5;
            --loading-color: #594AE2;
        }

        /* System Preference Fallback (if no data-theme yet) */
        @media (prefers-color-scheme: dark) {
            :root {
                --loading-bg: #121212;
                --loading-color: #7e6fff;
            }
        }

        /* User Theme Overrides (Applied via Script) */
        html[data-theme='light'] {
            --loading-bg: #f5f5f5 !important;
            --loading-color: #594AE2 !important;
        }

        html[data-theme='dark'] {
            --loading-bg: #121212 !important;
            --loading-color: #7e6fff !important;
        }

        html,
        body {
            /* Force Opaque Background on ALL platforms.
               This covers Mac Flash AND Windows Default Black issues.
               Since we now inject the correct theme instantly via LocalStorage, 
               this will always match the User's choice. */
            background-color: var(--loading-bg) !important;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            font-family: 'Roboto', sans-serif;
            color: var(--loading-color);
            /* Background matches body */
            background-color: inherit;
        }

        .loading-icon {
            width: 48px;
            height: 48px;
            fill: currentColor;
            animation: spin 1.5s linear infinite;
            margin-bottom: 16px;
        }

        .loading-text {
            font-size: 1.5rem;
            font-weight: 500;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">
        <!-- Styles moved to head for critical rendering performance -->
        <div class="loading-container">
            <svg class="loading-icon" viewBox="0 0 24 24">
                <path
                    d="M14 19v2H6v-2h8zm-2-4v2H6v-2h6zm4-8V9H6V7h10zM18 3v2H6V3h12zm-4 12v2h-2v-2h2zm-4-4V9H6V7h4v4z" />
            </svg>
            <div class="loading-text">Loading Daily...</div>
        </div>
    </div>

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script>
        window.addEventListener('mouseup', function (event) {
            // Button 3 is the "Back" button on many mice
            if (event.button === 3) {
                event.preventDefault();
                DotNet.invokeMethodAsync('Daily', 'HandleNativeBack');
            }
        });
    </script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
</body>

</html>